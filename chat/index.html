<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elivu AI | Ultimate Intelligence</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link href="[https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap](https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap)" rel="stylesheet">
    <script src="[https://cdn.jsdelivr.net/npm/marked/marked.min.js](https://cdn.jsdelivr.net/npm/marked/marked.min.js)"></script>
    <link rel="stylesheet" href="[https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/tokyo-night-dark.min.css](https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/tokyo-night-dark.min.css)">
    <script src="[https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js](https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js)"></script>
    <style>
        :root {
            --purple-main: #9b59b6;
            --purple-accent: #8e44ad;
            --neon-blue: #3498db;
            --bg-primary: #121220;
            --bg-secondary: #1e1e2f;
            --text-color: #f0f6f6;
            --text-secondary: #a0a0c0;
            --glass-bg: rgba(30, 30, 47, 0.6);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        [data-theme="light"] {
            --bg-primary: #f0f2f5;
            --bg-secondary: #ffffff;
            --text-color: #1c1e21;
            --text-secondary: #555577;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(0, 0, 0, 0.08);
        }

        * { box-sizing: border-box; transition: background-color 0.4s, color 0.4s; }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-primary);
            color: var(--text-color);
            height: 100vh; margin: 0; display: flex; flex-direction: column; overflow: hidden;
        }

        /* Background Effects from uxp.css */
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 10% 20%, rgba(155, 89, 182, 0.1) 0%, transparent 20%),
                        radial-gradient(circle at 90% 80%, rgba(52, 152, 219, 0.1) 0%, transparent 20%);
            z-index: -1;
        }

        header {
            height: 80px; padding: 0 40px; display: flex; justify-content: space-between; align-items: center;
            background: var(--glass-bg); backdrop-filter: blur(12px); border-bottom: 1px solid var(--glass-border);
        }

        .brand { font-size: 1.8em; font-weight: 600; background: linear-gradient(135deg, #9b59b6, #3498db); -webkit-background-clip: text; color: transparent; }

        /* Theme Toggle Morphing Style */
        .theme-toggle {
            cursor: pointer; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;
            border-radius: 50%; background: var(--glass-bg); border: 1px solid var(--glass-border); position: relative;
        }

        .theme-icon-container { position: relative; width: 24px; height: 24px; }
        .sun { background: #f1c40f; border-radius: 50%; box-shadow: 0 -12px 0 0.5px #f39c12, 0 12px 0 0.5px #f39c12, -12px 0 0 0.5px #f39c12, 12px 0 0 0.5px #f39c12; transition: all 0.6s cubic-bezier(0.45, 0.05, 0.55, 0.95); }
        .moon { background: #f0f6f6; border-radius: 50%; box-shadow: inset 7px -7px 0 1px #a0a0c0; transform: scale(0); opacity: 0; transition: all 0.6s cubic-bezier(0.45, 0.05, 0.55, 0.95); position: absolute; top:0; left:0; width:100%; height:100%; }
        
        [data-theme="dark"] .sun { transform: scale(1); opacity: 1; }
        [data-theme="light"] .sun { transform: rotate(90deg) scale(0); opacity: 0; }
        [data-theme="light"] .moon { transform: scale(1); opacity: 1; background: #1c1e21; box-shadow: inset 7px -7px 0 1px #555577; }

        #chat-box { flex-grow: 1; overflow-y: auto; padding: 40px 15%; display: flex; flex-direction: column; gap: 30px; }

        /* Code Blocks & Copy/Preview Buttons */
        .content pre { position: relative; background: #0d0d17; border-radius: 12px; padding: 15px; border: 1px solid var(--glass-border); margin: 15px 0; }
        .copy-btn, .preview-btn {
            position: absolute; top: 10px; right: 10px; background: var(--purple-main); color: white;
            border: none; padding: 5px 12px; border-radius: 6px; cursor: pointer; font-size: 0.75em; opacity: 0.8;
        }
        .preview-btn { right: 80px; background: var(--neon-blue); }
        .copy-btn:hover, .preview-btn:hover { opacity: 1; }

        .preview-frame { width: 100%; height: 300px; border: 1px solid var(--glass-border); border-radius: 8px; margin-top: 10px; background: white; display: none; }

        .message { display: flex; gap: 20px; animation: slideUp 0.4s ease; max-width: 1000px; width: 100%; margin: 0 auto; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .avatar { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--neon-blue); object-fit: cover; }
        .content { line-height: 1.8; font-size: 1em; flex-grow: 1; }

        .input-area { padding: 30px 15%; background: linear-gradient(to top, var(--bg-primary) 80%, transparent); }
        .input-wrapper { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 20px; padding: 10px 20px; display: flex; align-items: flex-end; backdrop-filter: blur(20px); }
        textarea { flex-grow: 1; background: transparent; border: none; color: var(--text-color); font-family: inherit; font-size: 1.1em; padding: 10px; outline: none; resize: none; max-height: 200px; }
        
        .btn-danger { background: #e74c3c; color: white; padding: 10px 20px; border-radius: 10px; border: none; cursor: pointer; font-weight: 600; margin-left: 10px; }

        @media (max-width: 768px) { #chat-box, .input-area { padding: 20px 5%; } }
    </style>
</head>
<body data-theme="dark">

    <header>
        <div class="brand">Elivu AI</div>
        <div style="display: flex; align-items: center; gap: 15px;">
            <button class="btn-danger" id="del-btn" onclick="confirmDelete()">Remove Chat</button>
            <button class="theme-toggle" onclick="toggleTheme()">
                <div class="theme-icon-container">
                    <div class="sun"></div>
                    <div class="moon"></div>
                </div>
            </button>
        </div>
    </header>

    <div id="chat-box"></div>

    <div class="input-area">
        <div class="input-wrapper">
            <textarea id="user-input" rows="1" placeholder="Elivu AI is listening..."></textarea>
            <button id="send-btn" style="background: var(--purple-main); color:white; border:none; width:45px; height:45px; border-radius:12px; cursor:pointer;">âž¤</button>
        </div>
    </div>

    <script>
        const API_URL = "[https://burlington-them-soa-cure.trycloudflare.com/ask](https://burlington-them-soa-cure.trycloudflare.com/ask)";
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        let sessionId = localStorage.getItem('elivu_v2') || ('el_' + Math.random().toString(36).substr(2, 9));
        localStorage.setItem('elivu_v2', sessionId);

        marked.setOptions({
            highlight: (code, lang) => hljs.highlightAuto(code).value,
            breaks: true
        });

        async function sendMsg() {
            const msg = userInput.value.trim();
            if(!msg || sendBtn.disabled) return;

            appendMessage(msg, true);
            userInput.value = "";
            userInput.style.height = 'auto';
            sendBtn.disabled = true;

            const aiNode = appendMessage("", false, true);
            let fullText = "";

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: msg, session_id: sessionId })
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                aiNode.content.innerHTML = "";

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    const chunk = decoder.decode(value);
                    const lines = chunk.split("\n");
                    for (const line of lines) {
                        if (line.startsWith("data: ")) {
                            fullText += line.replace("data: ", "");
                            aiNode.content.innerHTML = marked.parse(fullText);
                            processCodeBlocks(aiNode.content);
                            chatBox.scrollTop = chatBox.scrollHeight;
                        }
                    }
                }
                aiNode.img.src = "aiavatar.svg";
            } catch (e) {
                aiNode.img.src = "error.svg";
                aiNode.content.innerText = "Error: Connection lost.";
            } finally {
                sendBtn.disabled = false;
            }
        }

        function appendMessage(text, isUser, isLoading = false) {
            const div = document.createElement('div');
            div.className = 'message';
            const src = isUser ? "useravatar.svg" : (isLoading ? "loading.svg" : "aiavatar.svg");
            div.innerHTML = `
                <img src="${src}" class="avatar">
                <div class="content">${isUser ? text : marked.parse(text)}</div>
            `;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
            if(!isUser) processCodeBlocks(div.querySelector('.content'));
            return { content: div.querySelector('.content'), img: div.querySelector('.avatar') };
        }

        function processCodeBlocks(container) {
            container.querySelectorAll('pre').forEach(pre => {
                if (pre.querySelector('.copy-btn')) return;

                const code = pre.querySelector('code');
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.innerText = 'Copy';
                copyBtn.onclick = () => {
                    navigator.clipboard.writeText(code.innerText);
                    copyBtn.innerText = 'Copied!';
                    setTimeout(() => copyBtn.innerText = 'Copy', 2000);
                };
                pre.appendChild(copyBtn);

                // HTML Preview Support
                if (code.className.includes('language-html')) {
                    const previewBtn = document.createElement('button');
                    previewBtn.className = 'preview-btn';
                    previewBtn.innerText = 'Preview';
                    const frame = document.createElement('iframe');
                    frame.className = 'preview-frame';
                    
                    previewBtn.onclick = () => {
                        const isHidden = frame.style.display === 'none' || !frame.style.display;
                        frame.style.display = isHidden ? 'block' : 'none';
                        if(isHidden) {
                            frame.srcdoc = code.innerText;
                        }
                    };
                    pre.appendChild(previewBtn);
                    pre.after(frame);
                }
                hljs.highlightElement(code);
            });
        }

        function toggleTheme() {
            const b = document.body;
            const theme = b.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            b.setAttribute('data-theme', theme);
        }

        function confirmDelete() {
            if(confirm("DANGER: This will wipe all memory. Continue?")) {
                localStorage.removeItem('elivu_v2');
                location.reload();
            }
        }

        sendBtn.onclick = sendMsg;
        userInput.onkeydown = (e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMsg(); } };
        userInput.oninput = function() { this.style.height = 'auto'; this.style.height = this.scrollHeight + 'px'; };
    </script>
</body>
</html>